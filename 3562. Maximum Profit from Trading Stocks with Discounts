#!/usr/bin/python
"""You can see the description of the task using the code specified in the title on leetcode.
This program has O(n * budget ** 2) complexity by time and O(budget) by space.

I spent a long time trying to figure out how to approach the solution, but without any hints, I couldn't solve it in an hour.
In retrospect, I see that the DP here is quite simple, but I often have trouble with it, so I'm not surprised.
"""

# https://leetcode.com/problems/maximum-profit-from-trading-stocks-with-discounts/editorial/?envType=daily-question&envId=2025-12-16
class Solution:
    def maxProfit(self, n, present, future, hierarchy, budget):
        g = [[] for _ in range(n)]
        for e in hierarchy:
            g[e[0] - 1].append(e[1] - 1)

        def dfs(u: int):
            cost = present[u]
            dCost = present[u] // 2
            dp0 = [0] * (budget + 1)
            dp1 = [0] * (budget + 1)
            subProfit0 = [0] * (budget + 1)
            subProfit1 = [0] * (budget + 1)
            uSize = cost

            for v in g[u]:
                child_dp0, child_dp1, vSize = dfs(v)
                uSize += vSize
                for i in range(budget, -1, -1):
                    for sub in range(min(vSize, i) + 1):
                        if i - sub >= 0:
                            subProfit0[i] = max(
                                subProfit0[i],
                                subProfit0[i - sub] + child_dp0[sub],
                            )
                            subProfit1[i] = max(
                                subProfit1[i],
                                subProfit1[i - sub] + child_dp1[sub],
                            )

            for i in range(budget + 1):
                dp0[i] = subProfit0[i]
                dp1[i] = subProfit0[i]
                if i >= dCost:
                    dp1[i] = max(
                        subProfit0[i], subProfit1[i - dCost] + future[u] - dCost
                    )
                if i >= cost:
                    dp0[i] = max(
                        subProfit0[i], subProfit1[i - cost] + future[u] - cost
                    )

            return dp0, dp1, uSize

        return dfs(0)[0][budget]
